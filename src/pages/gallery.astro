---
import Layout from "../layouts/Layout.astro";
import GalleryPage from "../components/Gallerypage.jsx";
import { getLangFromUrl, loadTina, loadContent } from "../utils/i18n.js";

const lang = getLangFromUrl(Astro.url) || "en";

// Fetch the content for the gallery page using TinaCMS
const pageResponse = await loadTina(lang, "gallery");
const siteConfig = await loadContent(lang, "site_config");

// Prepare props to be passed to the React component
const tinaProps = {
  data: pageResponse.data,
  query: pageResponse.query,
  variables: pageResponse.variables,
};

// Extract gallery-specific data for metadata in the layout
const galleryData = (pageResponse.data as any)[`gallery_${lang}`] || {};
---

<Layout
  title={`Gallery - ${siteConfig.organization?.name || "Our Organization"}`}
  description={galleryData.hero?.description ||
    "A gallery of our cultural events and activities."}
  lang={lang}
>
  {/* Render the interactive React component on the client */}
  <GalleryPage props={tinaProps} lang={lang} client:load />
</Layout>
