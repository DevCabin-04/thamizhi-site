---
// src/pages/events.astro
import Layout from "../layouts/Layout.astro";
import EventsPage from "../components/Eventspage.jsx";
import { getLangFromUrl, loadTina, loadContent } from "../utils/i18n.js";

// Determine the language from the URL, default to 'en'
const lang = getLangFromUrl(Astro.url) || "en";

// Fetch the content for the events page from TinaCMS
const pageResponse = await loadTina(lang, "events");

// Fetch the global site configuration
const siteConfig = await loadContent(lang, "site_config");

// Prepare props to be passed to the interactive React component
const tinaProps = {
  data: pageResponse.data,
  query: pageResponse.query,
  variables: pageResponse.variables,
};

// Extract the language-specific data for use in the Astro layout
const eventsData = (pageResponse.data as any)[`events_${lang}`] || {};
---

<Layout
  title={`Events - ${siteConfig.organization?.name}`}
  description={eventsData.hero?.description || "Upcoming events and activities from our organization"}
  lang={lang}
>
  {/* 
    Render the interactive EventsPage component on the client.
    'client:load' ensures the component's JavaScript is loaded and hydrated as soon as the page loads.
  */}
  <EventsPage
    props={tinaProps}
    lang={lang}
    client:load
  />
</Layout>