---
// src/pages/index.astro
import Layout from "../../layouts/Layout.astro";
import HomePage from "../../components/Homepage";
import { getLangFromUrl, loadTina, loadContent, defaultLang, supportedLangs } from "../../utils/i18n.js";

// Static Path Generation for supported languages
export async function getStaticPaths() {
//   const supportedLanguages = ['en', 'ta', 'si'];
  return supportedLangs.map((lang) => ({
    params: { lang },
    props: { lang },
  }));
}

// Get language from props
const { lang } = Astro.props;
const currentLang = lang || defaultLang;

// const lang = getLangFromUrl(Astro.url) || "en";

// This is equivalent to getStaticProps in Next.js
const pageResponse = await loadTina(currentLang, "home");
const siteConfig = await loadContent(currentLang, "site_config");

// Prepare props for the React component
const tinaProps = {
  data: pageResponse.data,
  query: pageResponse.query,
  variables: pageResponse.variables,
};
const homeData = (pageResponse.data as any)[`home_${currentLang}`] || {};

---

<Layout 
  title={`${siteConfig.organization?.name} - ${siteConfig.organization?.tagline}`}
  description={homeData.hero?.description || "Default description"}
  lang={currentLang}
>
  <HomePage 
    props={tinaProps}
    lang={currentLang}
    client:load
  />
</Layout>